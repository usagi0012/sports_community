<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>동아리 상세 페이지</title>
        <link rel="stylesheet" href="css/club-detail.css" />
    </head>
    <body>
        <!-- 내 동아리 들어가면 동아리 수정 버튼 띄우기 -->
        <button class="updateBtn" onclick="openModal()">
            내 동아리 정보 수정
        </button>
        <button onclick="openApplyingModal()">동아리 신청하기</button>

        <!-- 내 동아리 들어가면 동아리 삭제 버튼 띄우기 -->
        <button onclick="deleteCheck()">등록된 동아리 삭제</button>

        <!-- 동아리 정보 수정 모달창 -->
        <div id="updateClubModal" class="modal">
            <div class="modal-content">
                <label for="name">이름:</label>
                <input type="text" id="name" />
                <br />
                <label for="location">지역:</label>
                <select id="location">
                    <option value="0">서울</option>
                    <option value="1">부산</option>
                    <option value="2">대구</option>
                    <option value="3">인천</option>
                    <option value="4">광주</option>
                    <option value="5">대전</option>
                    <option value="6">울산</option>
                    <option value="7">세종</option>
                    <option value="8">경기</option>
                    <option value="9">강원</option>
                    <option value="10">충청북도</option>
                    <option value="11">충청남도</option>
                    <option value="12">경상북도</option>
                    <option value="13">경상남도</option>
                    <option value="14">전라북도</option>
                    <option value="15">전라남도</option>
                    <option value="16">제주도</option>
                </select>
                <br />
                <label for="description">설명:</label>
                <textarea id="description"></textarea>
                <br />
                <input type="file" id="fileInput" />
                <br />
                <button onclick="submitForm()">제출</button>
                <button onclick="closeModal()">닫기</button>
            </div>
        </div>

        <!-- 동아리 신청 모달창 -->
        <div id="applyingClubModal" class="modal">
            <div class="modal-content">
                <!-- 기본값으로 클릭한 동아리의 id가 들어가도록 설정하기 
                하지만 사용자에게 보여주는 값은 동아리 "이름"이 보여질 수 있도록 하기 -->
                <label for="Applyingclub">지원할 동아리:</label>
                <p id="clubNameDisplay"></p>
                <br />
                <label for="description">지원이유:</label>
                <textarea id="description1"></textarea>
                <br />

                <button onclick="submitApplyingForm()">제출</button>
                <button onclick="closeApplyingModal()">닫기</button>
            </div>
        </div>

        <div class="name">이름</div>
        <div class="region">지역</div>
        <div class="classification">분류</div>
        <div class="gender">성별</div>
        <div class="member">회원수</div>
        <div class="createdAt">생성일자</div>
        <div class="clubMaster">동호회장</div>

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script type="module" src="./js/club-detail.js"></script>
        <script>
            const clubNameDiv = document.querySelector(".name");
            const clubNameDisplay = document.querySelector("#clubNameDisplay");
            const clubNameDetail = document.querySelector(".clubNameDetail");
            console.log("클럽네임", clubNameDiv);
            // console.log(clubNameDetail);
            // console.log("durl", clubNameDetail.textContent);
            // console.log("클럽이름", clubNameDiv);
            // console.log("클럽상세이름", clubNameDiv.children);
            // console.log(clubNameDiv.children[0].textContent);
            clubNameDisplay.innerHTML = ``;
            function openModal() {
                document.getElementById("updateClubModal").style.display =
                    "flex";
            }

            function closeModal() {
                document.getElementById("updateClubModal").style.display =
                    "none";
            }

            function submitForm() {
                //내 동아리인 경우에만 수정할 수 있도록 하기
                const name = document.getElementById("name").value;
                const region = document.getElementById("location").value;
                const description =
                    document.getElementById("description").value;
                const file = document.getElementById("fileInput").files[0];

                const authorized = localStorage.getItem("authorized");
                const token = JSON.parse(authorized).accessToken.value;
                axios
                    .put(
                        `/api/club/${clubId}`,
                        {
                            name: name,
                            region: region,
                            description: description,
                        },
                        {
                            headers: {
                                Authorization: `Bearer ${token}`,
                            },
                        },
                    )
                    .then(function (response) {
                        console.log(response);
                    })
                    .catch(function (error) {
                        console.log(error.response);
                        alert("동아리 정보를 수정할 수 없습니다.");
                    });
            }

            function openApplyingModal() {
                document.getElementById("applyingClubModal").style.display =
                    "flex";
            }
            function closeApplyingModal() {
                document.getElementById("applyingClubModal").style.display =
                    "none";
            }

            function submitApplyingForm() {
                const urlParams = new URLSearchParams(window.location.search);
                console.log("urlParams", urlParams);
                let clubId = urlParams.get("id");

                const authorized = localStorage.getItem("authorized");
                const token = JSON.parse(authorized).accessToken.value;

                const inputMessage = document.querySelector("#description1");
                const message = inputMessage.value;
                console.log("메세지값", message);
                console.log("메세지 타입", typeof message);

                axios
                    .post(
                        `/api/applying-club/${clubId}`,
                        {
                            message,
                        },
                        {
                            headers: {
                                Authorization: `Bearer ${token}`,
                            },
                        },
                    )
                    .then(function (response) {
                        console.log(response);
                        alert(response);
                    })
                    .catch(function (error) {
                        console.log(error.response);
                    });
            }

            function deleteCheck() {
                // alert(`${clubNameDiv} 동아리를 정말로 삭제하시겠습니까?`);
                const urlParams = new URLSearchParams(window.location.search);
                console.log("urlParams", urlParams);
                let clubId = urlParams.get("id");

                const authorized = localStorage.getItem("authorized");
                const token = JSON.parse(authorized).accessToken.value;

                axios
                    .delete(`api/club/${clubId}`, {
                        headers: {
                            Authorization: `Bearer ${token}`,
                        },
                    })
                    .then(function (response) {
                        console.log(response);
                        alert("정상적으로 삭제되었습니다.");
                        window.location.href =
                            "http://localhost:8001/club.html";
                    })
                    .catch(function (error) {
                        console.log(error);

                        // if (error.response.data.message === "Unauthorized") {
                        //     alert("동아리 생성자만 삭제할 수 있습니다.");
                        // }
                    });
            }
        </script>
    </body>
</html>
